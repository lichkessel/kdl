<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">

<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">


<link rel="import" href="./owed-list.html">

<dom-module id="class-detail">
  <template>
    <style include="shared-styles"></style>
    <!--iron-ajax
      url="http://jsonplaceholder.typicode.com/posts/[[app.classKey]]" 
      last-response="{{sheduleDetail}}"
      last-error="{{error}}"
      loading="{{loadingDetail}}"></iron-ajax-->

    <!--div hidden$="{{loadingDetail}}">{{sheduleDetail.body}}</div-->

    <iron-ajax id="ajax"
      url="http://jsonplaceholder.typicode.com/posts/[[sheduleItem.id]]/comments" 
      last-response="{{classStudents}}"
      last-error="{{error}}"
      on-response="_onResponse"></iron-ajax>

    <paper-material class="card-holder">
      <template is="dom-repeat" items="{{classStudents}}" >
        <div class="list-item">

          <div class="card">
            <div class="card-text" hidden$="[[item._toggled]]">[[item.name]]</div>
            <paper-spinner class="toggle-spinner" active or-hidden-1$="[[!item._expanded]]" or-hidden-2$="[[item._ready]]"></paper-spinner>
            <div class="card-toggle">
              <paper-icon-button class="expand-card" icon$="[[iconToggle(item._expanded)]]" on-tap="_toggleStudent"></paper-icon-button>
            </div>
          </div>

          <iron-collapse class="card-form" opened="[[item._ready]]">
            <div>
              <owed-list student="{{item}}"></owed-list>
            </div>
          </iron-collapse>

        </div>
      </template>

    </paper-material>

     

      <!--ol hidden$="{{loadingStudents}}">
        <template is="dom-repeat" items="{{classStudents}}" >
          <li>
            <div>[[item.name]]</div>
            <button on-click="_toggleOwed">toggle</button>
            <div hidden$="{{!item.expanded}}">
              <owed-list student-id="{{item.id}}" expanded="{{item.expanded}}"></owed-list>
            </div>
           </li>
        </template>
      </ol-->

  </template>
  <script>
    Polymer({
      is : "class-detail"
      ,properties : {
        sheduleItem : {
          type:Object
          ,notify:true
        }
        ,classStudents : {
          type: Array
          ,notify: true
        }
      }
      ,listeners : {
        'do-load-page' : '_loadPage'
      }
      ,ready : function() { 
        this.fire('component-loaded','shedule-detail');
      }
      ,_loadPage : function(e) {
        this.set('sheduleItem', e.detail.item);
        this.set('classStudents',[]);
        this.$.ajax.generateRequest();
      }
      ,_onResponse : function(e) {
        this.fire('page-ready');
      }
      ,iconToggle : function(exp) {
        return exp ? 'expand-less' : 'expand-more';
      }
      ,_toggleStudent : function(e) {
        e.model.set('item._expanded', !e.model.item._expanded);
        e.model.set('item._ready', false);
      }
      ,_toggleOwed : function(e) {
        e.model.set('item.expanded', !e.model.item.expanded);
      }
    });
  </script>
</dom-module>