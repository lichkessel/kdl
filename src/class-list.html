<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<!--link rel="import" href="../bower_components/iron-fit-behavior/iron-fit-behavior.html"-->

<link rel="import" href="./shared-styles.html">

<dom-module id="class-list">
  <template>
    <style include="shared-styles"></style>
    <style>

    </style>

    <iron-ajax id="ajax"
      url="http://seerio.us/kdlproxy/classes" 
      on-response="_onResponse"
      on-error="_onError"
      ></iron-ajax>

    <template is="dom-repeat" items="{{classes}}" as="item" initial-count="20">
      <paper-card heading="[[item.className]]" class="list-card">
        <div class="card-content"></div>
        <div class="card-actions">
          <paper-button on-tap="_viewClass">Detail</paper-button>
        </div>
      </paper-card>
    </template>

    <paper-fab class="add-button" icon="add" on-tap="_addNew"></paper-fab>

    </div>

  </template>
  <script>
    Polymer({
      is:'class-list',
      properties : {
        classes : {
          type: Array,
          notify:true,
          value : []
        }
      }
      ,listeners : {
        'do-load-page' : '_loadPage'
      }
      ,_loadPage : function(e) {
        this.$.ajax.generateRequest();
      }
      ,_onResponse : function(e) {
        this.fire('page-ready');
        if(!e.detail.response.error) {
          this.set('classes',e.detail.response);
        } else {
          this.fire('page-error', { message: e.detail.response.error })
        }
      }
      ,_onError : function(e) {
        this.fire('page-ready');
        this.fire('page-error', { message: 'Network problems! Try again later' })
      }
      ,_viewClass : function(e) {
        this.fire('load-page', { id: 'class-detail', item: e.model.item })
      }
      ,ready : function() {
        this.fire('component-loaded','class-list');
      }
    });
  </script>
</dom-module>
