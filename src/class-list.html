<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<!--link rel="import" href="../bower_components/iron-fit-behavior/iron-fit-behavior.html"-->

<link rel="import" href="./shared-styles.html">

<dom-module id="class-list">
  <template>
    <style include="shared-styles"></style>
    <style>

    </style>

    <iron-ajax id="get"
      url="http://seerio.us/kdlproxy/classes" 
      on-response="_onGetResponse"
      on-error="_onGetError"
      ></iron-ajax>

    <iron-ajax id="put"
      url="http://seerio.us/kdlproxy/classes" 
      on-response="_onPostResponse"
      on-error="_onPostError"
      method="POST"
      ></iron-ajax>

    <template is="dom-repeat" items="{{classes}}" as="item" initial-count="20">
      <paper-card heading="{{item.className}}" class="list-card">
        <div class="card-content"></div>
        <div class="card-actions">
          <paper-button on-tap="_viewClass">Detail</paper-button>
        </div>
      </paper-card>
    </template>

    <paper-fab class="add-button" icon="add" on-tap="_addNew"></paper-fab>

    </div>

  </template>
  <script>
    Polymer({
      is:'class-list'
      ,properties : {
        classes : {
          type: Array
          ,notify:true
          ,value : []
        }
        ,title : {
          type:String
          ,notify:true
          ,value:'Classes'
        }
      }
      ,_addNew : function(e) {
        this.unshift( 'classes', { _new : true, className:'New!', students:[] } );
        this.domHost.set( 'classItem', this.classes[0] );
      }
      ,_viewClass : function(e) {
        this.domHost.set('classItem', e.model.item);
      }
      ,_onPostResponse : function(e) {

      }
      ,_onPostError : function(e) {

      }
      ,_onGetResponse : function(e) {
        this.domHost.set('loaded',true);
        if(!e.detail.response.error) {
          this.set('classes', e.detail.response);
        } else {
          this.domHost.set('error',e.detail.response.error);
        }
      }
      ,_onGetError : function(e) {
        this.domHost.set('loaded',true);
        this.domHost.set('error','Network problems! Try again later');
      }
      ,load : function() {
        this.$.get.generateRequest();
      }
    });
  </script>
</dom-module>
