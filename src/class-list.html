<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<!--link rel="import" href="../bower_components/iron-fit-behavior/iron-fit-behavior.html"-->

<link rel="import" href="./shared-styles.html">

<dom-module id="class-list">
  <template>
    <style include="shared-styles"></style>
    <style>

    </style>

    <iron-ajax id="get"
      url="http://seerio.us/kdlproxy/classes" 
      on-response="_onResponse"
      on-error="_onError"
      ></iron-ajax>

    <template is="dom-repeat" items="{{classes}}" as="item" initial-count="20">
      <paper-card heading="{{item.className}}" class="list-card">
        <div class="card-content"></div>
        <div class="card-actions">
          <paper-button on-tap="_viewClass">Detail</paper-button>
        </div>
      </paper-card>
    </template>

    <paper-fab class="add-button" icon="add" on-tap="_addNew"></paper-fab>

    </div>

  </template>
  <script>
    Polymer({
      is:'class-list'
      ,properties : {
        classes : {
          type: Array
          ,notify:true
          ,value : []
        }
      }
      ,_addNew : function(e) {
        this.fire('view-class', { _editing : true, students : [] });
      }
      ,_viewClass : function(e) {
        e.model.item._editing = false;
        this.fire('view-class', e.model.item);
      }
      ,_onResponse : function(e) {
        this.domHost.set('loaded',true);
        if(!e.detail.response.error) {
          this.set('classes', e.detail.response);
        } else {
          this.fire('page-error',{ message: e.detail.response.error } );
        }
      }
      ,_onError : function(e) {
        this.domHost.set('loaded',true);
        this.fire('page-error',{ message: 'Network problems! Try again later' } );
      }
      ,load : function() {
        this.$.get.generateRequest();
      }
    });
  </script>
</dom-module>
